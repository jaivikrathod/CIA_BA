import{r as d,g as I,j as e,u as U}from"./index-BN8hKp7N.js";import{u as P}from"./index.esm-BXp1b-Ih.js";import{u as q,L,F,g as $,h as G,i as O,j as V,M as Y,y as o,k as B}from"./DefaultLayout-gdVRfkwL.js";import"./index-t--hEgTQ.js";const T="/CIA_BA/assets/pdf-2IR4PAqt.jpg",Q=()=>{const[n,m]=d.useState(!1),[y,r]=d.useState({show:!1,id:null}),i=q(),k=I(),[h,A]=d.useState([]),[a,u]=d.useState(null),[g,j]=d.useState({show:!1,id:null}),v=async()=>{try{const s=await i.post("/customer-list");s.data.data&&A(s.data.data)}catch{o.error("Failed to fetch customers")}};d.useEffect(()=>{v()},[]);const S=async s=>{try{await i.post("/customer-delete",{id:s}),o.success("Customer deleted successfully"),j({show:!1,id:null}),v()}catch{o.error("Error deleting customer")}},D=s=>{k(`/insurance-initial/${s}`)},w=s=>{r({show:!0,id:s})},[f,t]=d.useState(""),[l,x]=d.useState({gender:"",ageRange:""}),p=h==null?void 0:h.filter(s=>{const b=s.full_name.toLowerCase().includes(f.toLowerCase())||s.email.toLowerCase().includes(f.toLowerCase()),N=l.gender?s.gender==l.gender:!0,_=l.ageRange?l.ageRange==="0-18"?s.age<=18:l.ageRange==="19-35"?s.age>18&&s.age<=35:l.ageRange==="36-60"?s.age>35&&s.age<=60:s.age>60:!0;return b&&N&&_}),M=()=>{const s=["Sr. No.","Name","Email","Primary Mobile","Age","Gender","Address"],b=p.map((c,E)=>[E+1,c.full_name,c.email,c.primary_mobile,c.age||"N/A",c.gender||"N/A",c.full_address||"N/A"]);let N="data:text/csv;charset=utf-8,";N+=s.join(",")+`
`,b.forEach(c=>N+=c.join(",")+`
`);const _=encodeURI(N),C=document.createElement("a");C.setAttribute("href",_),C.setAttribute("download","customers.csv"),document.body.appendChild(C),C.click()};return e.jsxs("div",{className:"container",children:[e.jsx(L,{position:"top-right",autoClose:3e3,hideProgressBar:!0}),e.jsxs("div",{className:"container-fluid p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h2",{children:"Customer Management"}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{u({}),m(!0)},children:[e.jsx(F,{})," New Customer"]})]}),h.length===0?e.jsx("div",{className:"alert alert-info text-center",role:"alert",children:"No customers found. Please add a new customer."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4 mb-2",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by name or email",value:f,onChange:s=>t(s.target.value)})}),e.jsx("div",{className:"col-md-3 mb-2",children:e.jsxs("select",{className:"form-control",value:l.gender,onChange:s=>x({...l,gender:s.target.value}),children:[e.jsx("option",{value:"",children:"All Genders"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]})}),e.jsx("div",{className:"col-md-3 mb-2",children:e.jsxs("select",{className:"form-control",value:l.ageRange,onChange:s=>x({...l,ageRange:s.target.value}),children:[e.jsx("option",{value:"",children:"All Ages"}),e.jsx("option",{value:"0-18",children:"0-18"}),e.jsx("option",{value:"19-35",children:"19-35"}),e.jsx("option",{value:"36-60",children:"36-60"}),e.jsx("option",{value:"60+",children:"60+"})]})}),e.jsx("div",{className:"col-md-2 mb-2",children:e.jsxs("button",{className:"btn btn-success w-100",onClick:M,children:[e.jsx($,{})," Download CSV"]})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{className:"thead-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Sr. No."}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Primary Mobile"}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Gender"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Actions"}),e.jsx("th",{children:"Files & Details"})]})}),e.jsx("tbody",{children:p.map((s,b)=>e.jsxs("tr",{style:{verticalAlign:"middle"},children:[e.jsx("td",{children:b+1}),e.jsx("td",{children:s.full_name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.primary_mobile}),e.jsx("td",{children:s.age||"N/A"}),e.jsx("td",{children:s.gender||"N/A"}),e.jsx("td",{children:s.full_address||"N/A"}),e.jsxs("td",{children:[e.jsx("button",{className:"btn btn-link",onClick:()=>u(s),title:"Info",children:e.jsx(G,{})}),e.jsx("button",{className:"btn btn-link text-danger",onClick:()=>j({show:!0,id:s.id}),title:"Delete",children:e.jsx(O,{})})]}),e.jsxs("td",{children:[e.jsx("button",{className:"btn btn-link text-info",onClick:()=>D(s.id),title:"Add Insurance",children:e.jsx(F,{})}),e.jsx("button",{className:"btn btn-link text-primary",onClick:()=>w(s.id),title:"Upload",children:e.jsx(V,{})})]})]},s.id))})]})})]})]}),e.jsx(Y,{customerId:y.id,show:y.show,isCustomerDoc:!0,handleClose:()=>r({show:!1,id:null})}),a!==null&&e.jsx(z,{customer:a,onClose:()=>{u(null),v(),m(!1)},setisReadable:m,isReadable:n}),g.show&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Confirm Delete"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>j({show:!1,id:null})})]}),e.jsx("div",{className:"modal-body",children:e.jsx("p",{children:"Are you sure you want to delete this customer?"})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-danger",onClick:()=>S(g.id),children:"Confirm"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>j({show:!1,id:null}),children:"Cancel"})]})]})})})]})},z=({customer:n,onClose:m,setisReadable:y,isReadable:r})=>{const{register:i,handleSubmit:k,setValue:h,reset:A,formState:{errors:a}}=P({defaultValues:n||{}}),u=q(),g=U(t=>t.apiUrl)+"/get-customer-uploads",[j,v]=d.useState(n.id);d.useEffect(()=>{n&&Object.keys(n).forEach(t=>h(t,n[t]))},[n,h]);const S=async t=>{try{const l=await u.post("/customer-create-edit",t);l.data.success?(o.success("Customer saved successfully!"),A(),m()):o.error(l.data.message)}catch(l){console.log(l),o.error(l)}},D=async t=>{try{(await u.post("/delete-customer-document",{selectedID:j,document:t})).data.success?(f(w.filter(x=>x.name!==t)),o.success("Document deleted successfully")):(console.log("djfhb"),o.error("Error deleting document"))}catch(l){console.log(l),o.error("Error deleting document")}},[w,f]=d.useState(n.documents?JSON.parse(n.documents):[]);return e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-lg",children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"90vh",overflowY:"hidden"},children:[e.jsxs("div",{className:"modal-header bg-dark text-white",children:[r&&e.jsx("h5",{className:"modal-title",children:n.id?"Edit Customer":"New Customer"}),!r&&e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"modal-title",children:"Customer Details"}),e.jsx(B,{className:"ms-4",style:{cursor:"pointer"},onClick:()=>y(!0)})]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:m})]}),e.jsx("div",{className:"modal-body p-4",style:{maxHeight:"90vh",overflowY:"auto"},children:e.jsxs("form",{onSubmit:k(S),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Full Name"}),e.jsx("input",{type:"text",...i("full_name",{required:"Full Name is required",validate:t=>{const l=t.trim();return/^[A-Za-z\s]+$/.test(l)?!0:"Only letters are allowed"}}),className:"form-control",disabled:!r}),a.full_name&&e.jsx("small",{className:"text-danger",children:a.full_name.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Email"}),e.jsx("input",{type:"email",...i("email",{required:"Email is required"}),className:"form-control",disabled:!r}),a.email&&e.jsx("small",{className:"text-danger",children:a.email.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Primary Mobile"}),e.jsx("input",{type:"text",maxLength:10,...i("primary_mobile",{required:"Primary Mobile is required",pattern:{value:/^[0-9]{10}$/,message:"Mobile number must be exactly 10 digits"}}),className:"form-control",disabled:!r}),a.primary_mobile&&e.jsx("small",{className:"text-danger",children:a.primary_mobile.message}),a.primary_mobile&&e.jsx("small",{className:"text-danger",children:a.primary_mobile.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Additional Mobile"}),e.jsx("input",{type:"text",maxLength:10,...i("additional_mobile",{required:"Primary Mobile is required",pattern:{value:/^[0-9]{10}$/,message:"Mobile number must be exactly 10 digits"}}),className:"form-control",disabled:!r}),a.additional_mobile&&e.jsx("small",{className:"text-danger",children:a.additional_mobile.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Date of birth"}),e.jsx("input",{type:"date",...i("dob",{required:"Date of birth is required",validate:t=>{const l=new Date(t),x=new Date,p=new Date;return p.setFullYear(x.getFullYear()-120),l>=p||"DOB cannot be more than 120 years ago"}}),className:"form-control",disabled:!r}),a.dob&&e.jsx("small",{className:"text-danger",children:a.dob.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Gender"}),e.jsxs("select",{disabled:!r,...i("gender",{required:"Gender is required"}),className:"form-select",children:[e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]}),a.gender&&e.jsx("small",{className:"text-danger",children:a.gender.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"State"}),e.jsx("input",{type:"text",...i("state",{required:"State is required"}),className:"form-control",disabled:!r}),a.state&&e.jsx("small",{className:"text-danger",children:a.state.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"City"}),e.jsx("input",{type:"text",...i("city",{required:"City is required"}),className:"form-control",disabled:!r}),a.city&&e.jsx("small",{className:"text-danger",children:a.city.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Full Address"}),e.jsx("textarea",{...i("full_address",{required:"Address is required"}),className:"form-control",disabled:!r,rows:"4"}),a.full_address&&e.jsx("small",{className:"text-danger",children:a.full_address.message})]}),e.jsx("div",{className:"mb-4 d-flex",children:w.map((t,l)=>e.jsxs("div",{className:"position-relative ms-3",children:[e.jsxs("a",{href:`${g}/${t.name}`,target:"_blank",className:"text-primary",style:{textDecoration:"none",position:"relative",display:"inline-block"},children:[t.ext===".pdf"?e.jsx("img",{src:T,style:{width:"100px",height:"auto",display:"block"}}):e.jsx("img",{src:`${g}/${t.name}`,alt:t.type,style:{width:"100px",height:"auto",display:"block"}}),r&&e.jsx("button",{className:"position-absolute top-0 end-0 bg-danger text-white border-0 rounded-circle d-flex align-items-center justify-content-center",style:{width:"22px",height:"22px",fontSize:"14px",cursor:"pointer",transform:"translate(50%, -50%)"},onClick:()=>D(t.name),children:"×"})]}),e.jsx("div",{className:"text-center mt-2",children:t.type})]},l))}),r&&e.jsxs("div",{className:"d-flex justify-content-end mt-4",children:[e.jsx("button",{type:"submit",className:"btn btn-success px-4",children:n.id?"Update":"Create"}),e.jsx("button",{type:"button",className:"btn btn-danger ms-2",onClick:m,children:"Cancel"})]})]})})]})})})};export{Q as default};
