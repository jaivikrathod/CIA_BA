import{r,u as O,d as L,c as X,j as e,L as Y,e as ee}from"./index-CRICFKxU.js";import{y as c,L as se,F as T,h as ae,i as te,j as le,k as ne,M as re,l as ie}from"./DefaultLayout-C5VH_Vit.js";import"./iconBase-K3-QF6rt.js";const de="/CIA_BA/assets/pdf-2IR4PAqt.jpg",ue=()=>{const[o,f]=r.useState(!1),[D,d]=r.useState({show:!1,id:null}),y=O(),[m,q]=r.useState([]),v=L(s=>s.id),E=L(s=>s.adminType),n=X(),[x,g]=r.useState([]),[F,M]=r.useState(null),[_,p]=r.useState({show:!1,id:null}),[w,I]=r.useState(""),[a,S]=r.useState({gender:"",ageRange:"",admin:""}),[t,i]=r.useState(1),[C,k]=r.useState(!0),[P,R]=r.useState(!1),U=r.useRef(null),A=r.useCallback(async(s=1,l=!1,h=10,j=w)=>{try{const u=await y.post("/customer-list",{search:j,gender:a.gender,ageRange:a.ageRange,minAge:a.ageRange.split("-")[0]||"",maxAge:a.ageRange.split("-")[1]||"",admin:a.admin,page:s,limit:h});u.data.data?(g(l?N=>[...N,...u.data.data]:u.data.data),k(u.data.pagination.isMoreData)):(l||g([]),k(!1))}catch{c.error("Failed to fetch customers")}},[w,a.gender,a.ageRange,a.admin]),G=async()=>{try{const s=await y.post("/user-list");s.data.data&&q(s.data.data)}catch(s){c.error(s.response.data.message)}},$=r.useCallback(s=>{U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{i(1),A(1,!1,10,s)},1e3)},[A]),W=s=>{const l=s.target.value;I(l),$(l||"")};r.useEffect(()=>{i(1),A(1,!1)},[a.gender,a.ageRange,a.admin]),r.useEffect(()=>{G()},[]);const B=async s=>{try{await y.post("/customer-delete",{id:s}),c.success("Customer deleted successfully"),p({show:!1,id:null}),A()}catch{c.error("Error deleting customer")}},H=s=>{n(`/insurance-initial/${s}`)},V=s=>{d({show:!0,id:s})},z=async()=>{try{R(!0);const s=await y.post("/customer-list",{search:w,gender:a.gender,ageRange:a.ageRange,minAge:a.ageRange.split("-")[0]||"",maxAge:a.ageRange.split("-")[1]||"",page:1,limit:0});if(!s.data.data){c.error("No customer data available");return}const l=["Sr. No.","Name","Email","Primary Mobile","Age","Gender","Address"],h=s.data.data.map((b,Q)=>[Q+1,b.full_name,b.email,b.primary_mobile,b.age||"N/A",b.gender||"N/A",b.full_address||"N/A"]);let j="data:text/csv;charset=utf-8,";j+=l.join(",")+`
`,h.forEach(b=>j+=b.join(",")+`
`);const u=encodeURI(j),N=document.createElement("a");N.setAttribute("href",u),N.setAttribute("download","customers.csv"),document.body.appendChild(N),N.click(),document.body.removeChild(N)}catch{c.error("Failed to download customer data")}finally{R(!1)}},J=s=>{if(!s)return"N/A";const l=new Date(s),h=new Date;let j=h.getFullYear()-l.getFullYear();const u=h.getMonth()-l.getMonth();return(u<0||u===0&&h.getDate()<l.getDate())&&j--,j},Z=()=>{const s=t+1;i(s),A(s,!0)},K=s=>{console.log(x);try{s.extras.isUpdate?g(l=>l.map(h=>h.id==s.data.id?s.data:h)):g(l=>[...l,s.data]),console.log(x)}catch(l){console.log(l)}};return e.jsxs("div",{className:"container-fluid px-0",style:{maxWidth:"100vw"},children:[e.jsx(se,{position:"top-right",autoClose:3e3,hideProgressBar:!0}),P&&e.jsx(Y,{}),e.jsxs("div",{className:"container-fluid p-3",children:[e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center flex-wrap gap-2",children:[e.jsx("h2",{className:"mb-0",children:"Customer Management"}),e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsxs("button",{className:"btn btn-primary",onClick:()=>{M({}),f(!0)},children:[e.jsx(T,{})," New Customer"]}),e.jsxs("button",{className:"btn btn-success",onClick:z,children:[e.jsx(ae,{})," Download CSV"]})]})]})})}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx("div",{className:"flex-grow-1",style:{minWidth:"200px"},children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by name or email",value:w,onChange:W})}),E=="Admin"&&e.jsx("div",{className:"flex-grow-1",style:{minWidth:"200px"},children:e.jsxs("select",{className:"form-control",value:a.admin,onChange:s=>S({...a,admin:s.target.value}),children:[e.jsx("option",{value:"",children:"All admins"}),m.map(s=>s.id!=v?e.jsx("option",{value:s.id,children:s.full_name},s.id):null),e.jsx("option",{value:v,children:"Self"},v)]})}),e.jsx("div",{className:"flex-grow-1",style:{minWidth:"200px"},children:e.jsxs("select",{className:"form-control",value:a.gender,onChange:s=>S({...a,gender:s.target.value}),children:[e.jsx("option",{value:"",children:"All Genders"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]})}),e.jsx("div",{className:"flex-grow-1",style:{minWidth:"200px"},children:e.jsxs("select",{className:"form-control",value:a.ageRange,onChange:s=>S({...a,ageRange:s.target.value}),children:[e.jsx("option",{value:"",children:"All Ages"}),e.jsx("option",{value:"0-18",children:"0-18"}),e.jsx("option",{value:"19-35",children:"19-35"}),e.jsx("option",{value:"36-60",children:"36-60"}),e.jsx("option",{value:"60-120",children:"60+"})]})})]})})}),x.length===0?e.jsx("div",{className:"alert alert-info text-center fade-in",role:"alert",children:"No customers found. Please add a new customer."}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"table-responsive fade-in",style:{maxHeight:"350px"},children:[e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{className:"thead-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Sr. No."}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Primary Mobile"}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Gender"}),e.jsx("th",{children:"Actions"}),e.jsx("th",{children:"Files & Details"})]})}),e.jsx("tbody",{children:x.map((s,l)=>e.jsxs("tr",{style:{verticalAlign:"middle"},children:[e.jsx("td",{children:l+1}),e.jsx("td",{children:s.full_name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.primary_mobile}),e.jsx("td",{children:J(s.dob)}),e.jsx("td",{children:s.gender||"N/A"}),e.jsxs("td",{children:[e.jsx("button",{className:"btn btn-link",onClick:()=>M(s),title:"Info",children:e.jsx(te,{})}),e.jsx("button",{className:"btn btn-link text-danger",onClick:()=>p({show:!0,id:s.id}),title:"Delete",children:e.jsx(le,{})})]}),e.jsxs("td",{children:[e.jsx("button",{className:"btn btn-link text-info",onClick:()=>H(s.id),title:"Add Insurance",children:e.jsx(T,{})}),e.jsx("button",{className:"btn btn-link text-primary",onClick:()=>V(s.id),title:"Upload",children:e.jsx(ne,{})})]})]},s.id))})]}),C&&x.length>0&&e.jsx("div",{className:"load-more-container",children:e.jsxs("button",{className:"btn btn-primary load-more-btn",onClick:Z,disabled:P,children:[P?e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}):null,"Load More"]})})]})})]}),e.jsx(re,{customerId:D.id,show:D.show,isCustomerDoc:!0,handleClose:()=>d({show:!1,id:null})}),F!==null&&e.jsx(oe,{customer:F,onClose:()=>{M(null),f(!1)},addEditCustomer:K,setisReadable:f,isReadable:o}),_.show&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show"}),e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Confirm Delete"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>p({show:!1,id:null})})]}),e.jsx("div",{className:"modal-body",children:e.jsx("p",{children:"By deleting this customer, all the related insurance will delete automatically so Are you sure you want to delete this customer?"})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-danger",onClick:()=>B(_.id),children:"Confirm"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>p({show:!1,id:null}),children:"Cancel"})]})]})})})]})]})},oe=({customer:o,onClose:f,setisReadable:D,isReadable:d,addEditCustomer:y})=>{const{register:m,handleSubmit:q,setValue:v,reset:E,formState:{errors:n}}=ee({defaultValues:o||{}}),x=O(),g=L(t=>t.apiUrl)+"/get-customer-uploads",[F,M]=r.useState(o.id),[_,p]=r.useState(!1);r.useEffect(()=>{o&&Object.keys(o).forEach(t=>v(t,o[t]))},[o,v]);const w=async t=>{try{p(!0);const i=await x.post("/customer-create-edit",t);i.data.success?(c.success("Customer saved successfully!"),E(),y(i.data),f()):c.error(i.data.message)}catch(i){c.error(i)}finally{p(!1)}},I=async t=>{try{(await x.post("/delete-customer-document",{selectedID:F,document:t})).data.success?(S(a.filter(C=>C.name!==t)),c.success("Document deleted successfully")):c.error("Error deleting document")}catch(i){console.log(i),c.error("Error deleting document")}},[a,S]=r.useState(o.documents?JSON.parse(o.documents):[]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show"}),e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-lg",children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"90vh",overflowY:"hidden"},children:[_&&e.jsx(Y,{}),e.jsxs("div",{className:"modal-header bg-dark text-white",children:[d&&e.jsx("h5",{className:"modal-title",children:o.id?"Edit Customer":"New Customer"}),!d&&e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"modal-title",children:"Customer Details"}),e.jsx(ie,{className:"ms-4",style:{cursor:"pointer"},onClick:()=>D(!0)})]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:f})]}),e.jsx("div",{className:"modal-body p-4",style:{maxHeight:"90vh",overflowY:"auto"},children:e.jsxs("form",{onSubmit:q(w),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Full Name"}),e.jsx("input",{type:"text",...m("full_name",{required:"Full Name is required",validate:t=>{const i=t.trim();return/^[A-Za-z\s]+$/.test(i)?!0:"Only letters are allowed"}}),className:"form-control",disabled:!d}),n.full_name&&e.jsx("small",{className:"text-danger",children:n.full_name.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Email"}),e.jsx("input",{type:"email",...m("email",{required:"Email is required"}),className:"form-control",disabled:!d}),n.email&&e.jsx("small",{className:"text-danger",children:n.email.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Primary Mobile"}),e.jsx("input",{type:"text",maxLength:10,...m("primary_mobile",{required:"Primary Mobile is required ",pattern:{value:/^[0-9]{10}$/,message:"Mobile number must be integer "}}),className:"form-control",disabled:!d}),n.primary_mobile&&e.jsx("small",{className:"text-danger",children:n.primary_mobile.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Additional Mobile"}),e.jsx("input",{type:"text",maxLength:10,...m("additional_mobile",{required:"Primary Mobile is required",pattern:{value:/^[0-9]{10}$/,message:"Mobile number must be exactly 10 digits"}}),className:"form-control",disabled:!d}),n.additional_mobile&&e.jsx("small",{className:"text-danger",children:n.additional_mobile.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Date of birth"}),e.jsx("input",{type:"date",...m("dob",{required:"Date of birth is required",validate:t=>{const i=new Date(t),C=new Date,k=new Date;return k.setFullYear(C.getFullYear()-120),i>=k||"DOB cannot be more than 120 years ago"}}),className:"form-control",disabled:!d}),n.dob&&e.jsx("small",{className:"text-danger",children:n.dob.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Gender"}),e.jsxs("select",{disabled:!d,...m("gender",{required:"Gender is required"}),className:"form-select",children:[e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]}),n.gender&&e.jsx("small",{className:"text-danger",children:n.gender.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"State"}),e.jsx("input",{type:"text",...m("state",{required:"State is required"}),className:"form-control",disabled:!d}),n.state&&e.jsx("small",{className:"text-danger",children:n.state.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"City"}),e.jsx("input",{type:"text",...m("city",{required:"City is required"}),className:"form-control",disabled:!d}),n.city&&e.jsx("small",{className:"text-danger",children:n.city.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Full Address"}),e.jsx("textarea",{...m("full_address",{required:"Address is required"}),className:"form-control",disabled:!d,rows:"4"}),n.full_address&&e.jsx("small",{className:"text-danger",children:n.full_address.message})]}),e.jsx("div",{className:"mb-4 d-flex",children:a.map((t,i)=>e.jsxs("div",{className:"position-relative ms-3",children:[e.jsxs("a",{href:`${g}/${t.name}`,target:"_blank",className:"text-primary",style:{textDecoration:"none",position:"relative",display:"inline-block"},children:[t.ext===".pdf"?e.jsx("img",{src:de,style:{width:"100px",height:"auto",display:"block"}}):e.jsx("img",{src:`${g}/${t.name}`,alt:t.type,style:{width:"100px",height:"auto",display:"block"}}),d&&e.jsx("button",{className:"position-absolute top-0 end-0 bg-danger text-white border-0 rounded-circle d-flex align-items-center justify-content-center",style:{width:"22px",height:"22px",fontSize:"14px",cursor:"pointer",transform:"translate(50%, -50%)"},onClick:()=>I(t.name),children:"×"})]}),e.jsx("div",{className:"text-center mt-2",children:t.type})]},i))}),d&&e.jsxs("div",{className:"d-flex justify-content-end mt-4",children:[e.jsx("button",{type:"submit",className:"btn btn-success px-4",children:o.id?"Update":"Create"}),e.jsx("button",{type:"button",className:"btn btn-danger ms-2",onClick:f,children:"Cancel"})]})]})})]})})})]})};export{ue as default};
