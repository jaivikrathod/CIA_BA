import{r as n,j as e}from"./index-CpLtnvQD.js";import{u as S}from"./index.esm-BXEEmO5K.js";import{u as v,L as k,F as E,g as F,h as _,i as D,y as m,k as q}from"./DefaultLayout-C0e-1Rj5.js";import"./index-t--hEgTQ.js";const V=()=>{const[r,i]=n.useState(!1),[c,t]=n.useState([]),[o,h]=n.useState(null),[u,d]=n.useState({show:!1,id:null}),[a,g]=n.useState(""),f=v(),l=async()=>{try{const s=await f.get("/agent-list");s.data.data&&t(s.data.data)}catch(s){m.error(s.response.data.message)}};n.useEffect(()=>{l()},[]);const x=async s=>{try{await f.post("/agent-delete",{id:s}),m.success("Agent deleted successfully"),d({show:!1,id:null}),l()}catch{m.error("Error deleting agent")}},y=c==null?void 0:c.filter(s=>s.full_name.toLowerCase().includes(a.toLowerCase())||s.email.toLowerCase().includes(a.toLowerCase())),w=()=>{const s=["Sr. No.","Name","Email","Primary Mobile"],b=y.map((j,A)=>[A+1,j.full_name,j.email,j.primary_mobile]);let p="data:text/csv;charset=utf-8,";p+=s.join(",")+`
`,b.forEach(j=>p+=j.join(",")+`
`);const C=encodeURI(p),N=document.createElement("a");N.setAttribute("href",C),N.setAttribute("download","agents.csv"),document.body.appendChild(N),N.click()};return e.jsxs("div",{className:"container",children:[e.jsx(k,{position:"top-right",autoClose:3e3,hideProgressBar:!0}),e.jsxs("div",{className:"container-fluid p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h2",{children:"Agent Management"}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{h({}),i(!0)},children:[e.jsx(E,{})," New Agent"]})]}),c.length===0?e.jsx("div",{className:"alert alert-info text-center",children:"No agents found. Please add a new agent."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4 mb-2",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by name or email",value:a,onChange:s=>g(s.target.value)})}),e.jsx("div",{className:"col-md-2 mb-2",children:e.jsxs("button",{className:"btn btn-success w-100",onClick:w,children:[e.jsx(F,{})," Download CSV"]})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{className:"thead-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Sr. No."}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Primary Mobile"}),e.jsx("th",{children:"Files & Details"})]})}),e.jsx("tbody",{children:y.map((s,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:b+1}),e.jsx("td",{children:s.full_name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.primary_mobile}),e.jsxs("td",{children:[e.jsx("button",{className:"btn btn-link",title:"Info",onClick:()=>h(s),children:e.jsx(_,{})}),e.jsx("button",{className:"btn btn-link text-danger",title:"Delete",onClick:()=>d({show:!0,id:s.id}),children:e.jsx(D,{})})]})]},s.id))})]})})]})]}),o!==null&&e.jsx(L,{agent:o,onClose:()=>{h(null),l(),i(!1)},setisReadable:i,isReadable:r}),u.show&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Confirm Delete"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>d({show:!1,id:null})})]}),e.jsx("div",{className:"modal-body",children:e.jsx("p",{children:"Are you sure you want to delete this agent?"})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-danger",onClick:()=>x(u.id),children:"Confirm"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>d({show:!1,id:null}),children:"Cancel"})]})]})})})]})},L=({agent:r,onClose:i,setisReadable:c,isReadable:t})=>{const{register:o,handleSubmit:h,setValue:u,reset:d,formState:{errors:a}}=S(),g=v();n.useEffect(()=>{r&&Object.keys(r).forEach(l=>u(l,r[l]))},[r,u]);const f=async l=>{try{const x=await g.post("/agent-create-edit",l);x.data.success?(m.success("Agent saved successfully!"),d(),i()):m.error(x.data.message||"Something went wrong")}catch{m.error("Error saving agent")}};return e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-lg",children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"90vh",overflowY:"hidden"},children:[e.jsxs("div",{className:"modal-header bg-dark text-white",children:[e.jsx("h5",{className:"modal-title",children:t?r.id?"Edit Agent":"New Agent":"Agent Details"}),!t&&e.jsx(q,{className:"ms-4",style:{cursor:"pointer"},onClick:()=>c(!0)}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:i})]}),e.jsx("div",{className:"modal-body p-4",style:{maxHeight:"90vh",overflowY:"auto"},children:e.jsxs("form",{onSubmit:h(f),children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold",children:"Full Name"}),e.jsx("input",{type:"text",...o("full_name",{required:"Full Name is required",pattern:{value:/^[A-Za-z\s]+$/,message:"Only letters allowed"}}),className:"form-control",disabled:!t}),a.full_name&&e.jsx("small",{className:"text-danger",children:a.full_name.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold",children:"Email"}),e.jsx("input",{type:"email",...o("email",{required:"Email is required"}),className:"form-control",disabled:!t}),a.email&&e.jsx("small",{className:"text-danger",children:a.email.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold",children:"Primary Mobile"}),e.jsx("input",{type:"text",maxLength:10,...o("primary_mobile",{required:"Primary Mobile is required",pattern:{value:/^[0-9]{10}$/,message:"Must be exactly 10 digits"}}),className:"form-control",disabled:!t}),a.primary_mobile&&e.jsx("small",{className:"text-danger",children:a.primary_mobile.message})]}),t&&e.jsx("div",{className:"text-end",children:e.jsx("button",{className:"btn btn-primary",type:"submit",children:"Save Agent"})})]})})]})})})};export{V as default};
