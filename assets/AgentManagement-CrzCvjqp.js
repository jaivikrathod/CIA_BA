import{r as c,u as N,j as e,e as p}from"./index-CRICFKxU.js";import{L as y,F as v,i as w,j as A,y as h,l as C}from"./DefaultLayout-C5VH_Vit.js";import"./iconBase-K3-QF6rt.js";const _=()=>{const[t,d]=c.useState(!1),[o,a]=c.useState([]),[u,r]=c.useState(null),[j,n]=c.useState({show:!1,id:null}),[b,i]=c.useState(""),f=N(),x=async()=>{try{const s=await f.get("/agent-list");s.data.data&&a(s.data.data)}catch(s){h.error(s.response.data.message)}};c.useEffect(()=>{x()},[]);const m=async s=>{try{await f.post("/agent-delete",{id:s}),h.success("Agent deleted successfully"),n({show:!1,id:null}),x()}catch{h.error("Error deleting agent")}},l=o==null?void 0:o.filter(s=>s.full_name.toLowerCase().includes(b.toLowerCase())||s.email.toLowerCase().includes(b.toLowerCase()));return e.jsxs("div",{className:"container",children:[e.jsx(y,{position:"top-right",autoClose:3e3,hideProgressBar:!0}),e.jsxs("div",{className:"container-fluid p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h2",{children:"Agent Management"}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{r({}),d(!0)},children:[e.jsx(v,{})," New Agent"]})]}),o.length===0?e.jsx("div",{className:"alert alert-info text-center",children:"No agents found. Please add a new agent."}):e.jsx(e.Fragment,{children:e.jsx("div",{style:{maxHeight:"70vh",overflowY:"auto"},className:"table-responsive",children:e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{className:"thead-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Sr. No."}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Primary Mobile"}),e.jsx("th",{children:"Files & Details"})]})}),e.jsx("tbody",{children:l.map((s,g)=>e.jsxs("tr",{children:[e.jsx("td",{children:g+1}),e.jsx("td",{children:s.full_name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.primary_mobile}),e.jsxs("td",{children:[e.jsx("button",{className:"btn btn-link",title:"Info",onClick:()=>r(s),children:e.jsx(w,{})}),e.jsx("button",{className:"btn btn-link text-danger",title:"Delete",onClick:()=>n({show:!0,id:s.id}),children:e.jsx(A,{})})]})]},s.id))})]})})})]}),u!==null&&e.jsx(S,{agent:u,onClose:()=>{r(null),d(!1)},setisReadable:d,isReadable:t,fetchAgents:x}),j.show&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show"}),e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Confirm Delete"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>n({show:!1,id:null})})]}),e.jsx("div",{className:"modal-body",children:e.jsx("p",{children:"Are you sure you want to delete this agent?"})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-danger",onClick:()=>m(j.id),children:"Confirm"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>n({show:!1,id:null}),children:"Cancel"})]})]})})})]})]})},S=({agent:t,onClose:d,setisReadable:o,isReadable:a,fetchAgents:u})=>{const{register:r,handleSubmit:j,setValue:n,reset:b,formState:{errors:i}}=p(),f=N();c.useEffect(()=>{t&&Object.keys(t).forEach(m=>n(m,t[m]))},[t,n]);const x=async m=>{try{const l=await f.post("/agent-create-edit",m);console.log(l),l.data.success?(h.success("Agent saved successfully!"),b(),d(),u()):h.error(l.data.message||"Something went wrong")}catch(l){console.log(l),h.error(l.response.data.message)}};return e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-lg",children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"90vh",overflowY:"hidden"},children:[e.jsxs("div",{className:"modal-header bg-dark text-white",children:[e.jsx("h5",{className:"modal-title",children:a?t.id?"Edit Agent":"New Agent":"Agent Details"}),!a&&e.jsx(C,{className:"ms-4",style:{cursor:"pointer"},onClick:()=>o(!0)}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:d})]}),e.jsx("div",{className:"modal-body p-4",style:{maxHeight:"90vh",overflowY:"auto"},children:e.jsxs("form",{onSubmit:j(x),children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold",children:"Full Name"}),e.jsx("input",{type:"text",...r("full_name",{required:"Full Name is required",pattern:{value:/^[A-Za-z\s]+$/,message:"Only letters allowed"}}),className:"form-control",disabled:!a}),i.full_name&&e.jsx("small",{className:"text-danger",children:i.full_name.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold",children:"Email"}),e.jsx("input",{type:"email",...r("email",{required:"Email is required"}),className:"form-control",disabled:!a}),i.email&&e.jsx("small",{className:"text-danger",children:i.email.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold",children:"Primary Mobile"}),e.jsx("input",{type:"text",maxLength:10,...r("primary_mobile",{required:"Primary Mobile is required",pattern:{value:/^[0-9]{10}$/,message:"Must be exactly 10 digits"}}),className:"form-control",disabled:!a}),i.primary_mobile&&e.jsx("small",{className:"text-danger",children:i.primary_mobile.message})]}),a&&e.jsx("div",{className:"text-end",children:e.jsx("button",{className:"btn btn-primary",type:"submit",children:"Save Agent"})})]})})]})})})};export{_ as default};
