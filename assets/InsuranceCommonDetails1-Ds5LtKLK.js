import{e as D,c as Y,u as V,s as $,r as t,d as M,j as e,V as f}from"./index-CRICFKxU.js";function A(){const{register:c,handleSubmit:y,formState:{errors:r,isDirty:P,touchedFields:o},reset:p,setValue:i,watch:b}=D(),g=Y(),h=V(),{id:m}=$(),[d,j]=t.useState([]),[N,_]=t.useState([]),[v,w]=t.useState([]),S=M(s=>s.id),u=b("manufacturer"),x=b("model"),F=async()=>{var s,a;try{const l=await h.get("/cars");if(l.data.success){w(l.data.data);const n=[...new Set(l.data.data.map(q=>q.company_name))];_(n),console.log(n)}else f.error(l.message)}catch(l){f.error(((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"Error fetching vehicles")}};t.useEffect(()=>{F()},[]),t.useEffect(()=>{if(u&&v.length>0){const s=v.filter(a=>a.company_name===u).map(a=>a.model_name);j(s)}else j([])},[u,v]),t.useEffect(()=>{(async()=>{d.length>0&&x&&(d.includes(x)||i("model",""))})()},[d,x]),t.useEffect(()=>{m&&(async()=>{try{const a=await h.get(`/get-common-insurance/${m}`);if(a.data.success){const l=a.data.data;l.manufacturer&&i("manufacturer",l.manufacturer),l.model&&i("model",l.model),p(l)}}catch(a){console.error("Error fetching initial data:",a)}})()},[m,p,i]);const E=async s=>{var a,l;s.id=m,s.user_id=S;try{if((await h.post("/common-vehical",s)).data.message)f.success("Form submitted successfully!"),g(`/common-insurance2/${s.id}/0`);else throw new Error("Submission failed")}catch(n){f.error(((l=(a=n.response)==null?void 0:a.data)==null?void 0:l.message)||"An error occurred while submitting the form.")}};return e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("h2",{className:"",style:{color:"#2c3e50",fontWeight:"600"},children:"Vehicle Details"})})}),e.jsxs("form",{onSubmit:y(E),className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"vehicle_number",className:"form-label",children:"Vehicle Number"}),e.jsx("input",{type:"text",id:"vehicle_number",className:`form-control ${r.vehicle_number?"is-invalid":""}`,placeholder:"GJ01xxxx",...c("vehicle_number",{required:"Register No is required",pattern:{value:/^[A-Z]{2}[0-9]{2}[A-Z]{2}[0-9]{4}$/,message:"Invalid vehicle number format (e.g., GJ01AB1234)"}})}),r.vehicle_number&&e.jsx("div",{className:"invalid-feedback",children:r.vehicle_number.message})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"manufacturer",className:"form-label",children:"manufacturer"}),e.jsxs("select",{id:"manufacturer",className:`form-select ${o.manufacturer&&r.manufacturer?"is-invalid":""}`,...c("manufacturer",{required:"manufacturer is required",onChange:s=>{i("model","")}}),children:[e.jsx("option",{value:"",children:"Select manufacturer"}),N.map(s=>e.jsx("option",{value:s,children:s},s))]}),o.manufacturer&&r.manufacturer&&e.jsx("div",{className:"invalid-feedback",children:r.manufacturer.message})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"model",className:"form-label",children:"Model"}),e.jsxs("select",{id:"model",className:`form-select ${o.model&&r.model?"is-invalid":""}`,...c("model",{required:"model is required",validate:s=>u?!0:"Please select a manufacturer first"}),children:[e.jsx("option",{value:"",children:"Select model"}),d.map((s,a)=>e.jsx("option",{value:s,children:s},a))]}),o.model&&r.model&&e.jsx("div",{className:"invalid-feedback",children:r.model.message})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"fuel_type",className:"form-label",children:"Fuel Type"}),e.jsxs("select",{id:"fuel_type",className:`form-select ${r.fuel_type?"is-invalid":""}`,...c("fuel_type",{required:"Fuel Type is required"}),children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"petrol",children:"Petrol"}),e.jsx("option",{value:"diesel",children:"Diesel"}),e.jsx("option",{value:"electric",children:"Electric"}),e.jsx("option",{value:"hybrid",children:"Hybrid"})]}),r.fuel_type&&e.jsx("div",{className:"invalid-feedback",children:r.fuel_type.message})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{htmlFor:"yom",className:"form-label",children:"Purchase year"}),e.jsx("input",{type:"number",id:"yom",className:`form-control ${r.yom?"is-invalid":""}`,placeholder:"YYYY",...c("yom",{required:"Purchase year is required",min:{value:1900,message:"Year cannot be before 1900"},max:{value:new Date().getFullYear(),message:"Year cannot be in the future"},validate:s=>s<1900||s>new Date().getFullYear()?"Please enter a valid year between 1900 and "+new Date().getFullYear():!0})}),r.yom&&e.jsx("div",{className:"invalid-feedback",children:r.yom.message})]}),e.jsx("div",{className:"col-12",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})]})}export{A as default};
