import{c as U,r as t,e as B,s as f,f as L,d as j,u as R,j as i}from"./index-CRICFKxU.js";import{y as n,L as V}from"./DefaultLayout-C5VH_Vit.js";import"./iconBase-K3-QF6rt.js";function G(){var x;const b=U(),[q,N]=t.useState([]),{register:r,watch:p,setValue:l,handleSubmit:w,formState:{errors:s}}=B(),{id:P}=f(),{common_id:v}=f(),S=((x=L().state)==null?void 0:x.type)||!1,g=j(e=>e.id),d=R(),[k,F]=t.useState([]),[E,C]=t.useState([]),A=j(e=>e.adminType);t.useEffect(()=>{O(),$(),D()},[]);const D=async()=>{try{const e=await d.post("/user-list");C(e.data.data)}catch(e){n.error("Failed to fetch User"),console.error("Failed to fetch User:",e)}},O=async()=>{try{const e=await d.get("/agent-list");e.data.success?N(e.data.data):console.log("Error while fetching agents")}catch(e){console.log(e.response.data.message)}},$=async()=>{try{const e=await d.get("/insurance-companies");e.data.success?F(e.data.data):n.error("Error while fetching Insurance Company")}catch(e){n.error(e.response.data.message)}},I=async e=>{var m,u;try{if(e.insurance_id=P,e.user_id=e.emp_id??g,S){v?e.common_id=v:e.common_id=null;const a=await d.post("/common-general",e);if(a.data.message)n.success("Form submitted successfully!"),b(`/upload-insurance-document/${a.data.id}`);else throw new Error("Submission failed")}else{const a=await d.post("/common-general",e);if(a.data.message)n.success("Form submitted successfully!"),b(`/upload-insurance-document/${a.data.id}`);else throw new Error("Submission failed")}}catch(a){console.log(a),n.error(((u=(m=a.response)==null?void 0:m.data)==null?void 0:u.message)||a||"An error occurred while submitting the form.")}},T=[{label:"idv",type:"number",id:"idv",validation:{required:"idv is required"},width:"col-md-3"},{label:"Current NCB (%)",type:"number",id:"currentncb",validation:{required:"Current NCB is required"},width:"col-md-3"},{label:"Policy No",type:"text",id:"policy_no",validation:{required:"Policy No is required"},width:"col-md-3"},{label:"OD Premium",type:"number",id:"od_premium",validation:{required:"OD Premium is required"},width:"col-md-3"},{label:"TP Premium",type:"number",id:"tp_premium",validation:{required:"TP Premium is required"},width:"col-md-3"},{label:"Package Premium",type:"number",id:"package_premium",validation:{required:"Package Premium is required"},width:"col-md-3"},{label:"Premium",type:"number",id:"premium",validation:{required:"Premium is required"},width:"col-md-3"},{label:"gst (Premium - Package Premium)",type:"number",id:"gst",validation:{required:"gst is required"},disabled:!0,width:"col-md-3"},{label:"Insurance Date",type:"date",id:"insurance_date",validation:{required:"Insurance Date is required"},width:"col-md-3"},{label:"Collection Date",type:"date",id:"collection_date",validation:{required:"Collection Date is required"},width:"col-md-3"},{label:"New Policy Start Date",type:"date",id:"policy_start_date",validation:{required:"Start Date is required"},width:"col-md-3"},{label:"New Policy Expiry Date",type:"date",id:"policy_expiry_date",validation:{required:"Expiry Date is required"},width:"col-md-3"},{label:"Payout Percent",type:"number",id:"payout_percent",validation:{required:"Payout Percent is required"},adminOnly:!0,width:"col-md-3"},{label:"Amount",type:"number",id:"amount",validation:{required:"Amount is required"},adminOnly:!0,width:"col-md-3"},{label:"tds",type:"number",id:"tds",validation:{required:"tds is required"},adminOnly:!0,width:"col-md-3"}],h=(p("case_type")||"").toLowerCase(),[_,y]=t.useState("");t.useEffect(()=>{l("agent_id",null),l("emp_id",null)},[h]);const c=Number(p("package_premium")),o=Number(p("premium"));return t.useEffect(()=>{c&&o?c>o?(console.log("package premium"+c),console.log("premium"+o),y("Package premium can not be greater than premium"),l("gst",null)):(y(""),l("gst",o-c)):(y(""),l("gst",null))},[c,o]),i.jsxs(i.Fragment,{children:[i.jsxs("form",{className:"container",onSubmit:w(I),children:[i.jsxs("div",{className:"row g-3 ",children:[i.jsx("h3",{children:"Insurance Details"}),T.map(e=>{const m=!e.adminOnly||e.adminOnly&&A==="Admin",u=e.width||"col-md-6";return m&&i.jsxs("div",{className:u,children:[i.jsx("label",{htmlFor:e.id,className:"form-label",children:e.label}),i.jsx("input",{type:e.type,id:e.id,className:`form-control ${s[e.id]?"is-invalid":""}`,...r(e.id,e.validation),disabled:e.disabled}),s[e.id]&&i.jsx("div",{className:"invalid-feedback",children:s[e.id].message}),_.trim()&&(e.id==="package_premium"||e.id==="premium")&&i.jsx("div",{className:"invalid-feedback",children:_})]},e.id)}),i.jsxs("div",{className:"col-md-3",children:[i.jsx("label",{htmlFor:"case_type",className:"form-label",children:"Case type"}),i.jsxs("select",{id:"case_type",className:`form-select ${s.case_type?"is-invalid":""}`,...r("case_type",{required:"Case type is required"}),children:[i.jsx("option",{value:"",children:"Select Case type"}),i.jsx("option",{value:"office",children:"Office"}),i.jsx("option",{value:"agent",children:"Agent"})]}),s.case_type&&i.jsx("div",{className:"invalid-feedback",children:s.case_type.message})]}),h==="agent"&&i.jsxs("div",{className:"col-md-3",children:[i.jsx("label",{htmlFor:"agent_id",className:"form-label",children:"Agent"}),i.jsxs("select",{id:"agent_id",className:`form-select ${s.agent_id?"is-invalid":""}`,...r("agent_id",{required:"Agent is required"}),children:[i.jsx("option",{value:"",children:"Select Agent"}),q.map(e=>i.jsx("option",{value:e.id,children:e.full_name},e.id))]}),s.agent_id&&i.jsx("div",{className:"invalid-feedback",children:s.agent_id.message})]}),h==="office"&&i.jsxs("div",{className:"col-md-3",children:[i.jsx("label",{htmlFor:"emp_id",className:"form-label",children:"Office Employee"}),i.jsxs("select",{id:"emp_id",className:`form-select ${s.emp_id?"is-invalid":""}`,...r("emp_id",{required:"Employee is required"}),children:[i.jsx("option",{value:"",children:"Select Employee"}),E.map(e=>i.jsx("option",{value:e.id,children:e.full_name},e.id)),i.jsx("option",{value:g,children:"self"})]}),s.emp_id&&i.jsx("div",{className:"invalid-feedback",children:s.emp_id.message})]}),i.jsxs("div",{className:"col-md-3",children:[i.jsx("label",{htmlFor:"insurance_company",className:"form-label",children:"Insurance Company"}),i.jsxs("select",{id:"insurance_company",className:`form-select ${s.insurance_company?"is-invalid":""}`,...r("insurance_company",{required:"Insurance company is required"}),children:[i.jsx("option",{value:"",children:"Select company"}),k.map(e=>i.jsx("option",{value:e.name,children:e.name},e.id))]}),s.insurance_company&&i.jsx("div",{className:"invalid-feedback",children:s.insurance_company.message})]}),i.jsxs("div",{className:"col-md-3",children:[i.jsx("label",{htmlFor:"business_type",className:"form-label",children:"Business Type"}),i.jsxs("select",{id:"business_type",className:`form-select ${s.business_type?"is-invalid":""}`,...r("business_type",{required:"Insurance company is required"}),children:[i.jsx("option",{value:"",children:"Select Business type"}),i.jsx("option",{value:"Fresh",children:"Fresh"}),i.jsx("option",{value:"Renewal",children:"Renewal"})]}),s.business_type&&i.jsx("div",{className:"invalid-feedback",children:s.business_type.message})]}),i.jsxs("div",{className:"col-md-3 insurance-common-2-main",children:[i.jsx("label",{htmlFor:"agent_id",className:"form-label",children:"Payment Mode"}),i.jsxs("select",{id:"payment_mode",className:`form-select ${s.payment_mode?"is-invalid":""}`,...r("payment_mode",{required:"Agent is required"}),children:[i.jsx("option",{value:"",children:"Select Payment mode"}),i.jsx("option",{value:"online",children:"Online"}),i.jsx("option",{value:"offline",children:"Offline"}),i.jsx("option",{value:"offline",children:"Not Paid Yet"})]}),s.payment_mode&&i.jsx("div",{className:"invalid-feedback",children:s.payment_mode.message})]})]}),i.jsx("button",{type:"submit",className:"btn btn-primary mt-3",children:"Submit"})]}),i.jsx(V,{})]})}export{G as default};
